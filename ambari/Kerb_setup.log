
2018-11-06,20:02:12 Adding KERBEROS Service to cluster
{
  "status" : 409,
  "message" : "Attempted to create a service which already exists: , clusterName=enseclab serviceName=KERBEROS"
}
2018-11-06,20:02:12 Adding KERBEROS_CLIENT component to the KERBEROS service
-> 1
{
  "status" : 409,
  "message" : "Attempted to create one or more components which already exist:[clusterName=enseclab, serviceName=KERBEROS, componentName=enseclab, desiredState=null, recoveryEnabled=null, componentCategory=null]"
}[
  {
    "Clusters": {
      "desired_config": {
        "type": "krb5-conf",
        "tag": "version1",
        "properties": {
          "domains":"",
          "manage_krb5_conf": "true",
          "conf_dir":"/etc",
	  "content" : "includedir /var/lib/sss/pubconf/krb5.include.d/

[libdefaults]
  renew_lifetime = 7d
  forwardable = true
  default_realm = {{realm}}
  ticket_lifetime = 24h
  dns_lookup_realm = false
  dns_lookup_kdc = false
  rdns = false
  dns_canonicalize_hostname = false
  default_ccache_name = /tmp/krb5cc_%{uid}
  #default_tgs_enctypes = {{encryption_types}}
  #default_tkt_enctypes = {{encryption_types}}

{% if domains %}
[domain_realm]
{%- for domain in domains.split(',') %}
  {{domain|trim()}} = {{realm}}
{%- endfor %}
{% endif %}

[logging]
  default = FILE:/var/log/krb5kdc.log
  admin_server = FILE:/var/log/kadmind.log
  kdc = FILE:/var/log/krb5kdc.log

[realms]
  {{realm}} = {
{%- if master_kdc %}
    master_kdc = {{master_kdc|trim()}}
{%- endif -%}
{%- if kdc_hosts > 0 -%}
{%- set kdc_host_list = kdc_hosts.split(',')  -%}
{%- if kdc_host_list and kdc_host_list|length > 0 %}
    admin_server = {{admin_server_host|default(kdc_host_list[0]|trim(), True)}}
{%- if kdc_host_list -%}
{%- if master_kdc and (master_kdc not in kdc_host_list) %}
    kdc = {{master_kdc|trim()}}
{%- endif -%}
{% for kdc_host in kdc_host_list %}
    kdc = {{kdc_host|trim()}}
{%- endfor -%}
{% endif %}
{%- endif %}
{%- endif %}
  kpasswd_server =  {{master_kdc|trim()}}:464
  default_domain = {{domains.split(',')[0]|trim()}}
  pkinit_anchors = FILE:/var/lib/ipa-client/pki/kdc-ca-bundle.pem
  pkinit_pool = FILE:/var/lib/ipa-client/pki/ca-bundle.pem
  }

{# Append additional realm declarations below #}"
        }
      }
    }
  },
  {
    "Clusters": {
      "desired_config": {
        "type": "kerberos-env",
        "tag": "version1",
        "properties": {
          "kdc_type": "ipa",
          "manage_identities": "true",
          "install_packages": "true",
          "encryption_types": "aes des3-cbc-sha1 rc4 des-cbc-md5",
          "realm" : "FIELD.HORTONWORKS.COM",
          "kdc_hosts" : "enctrl.field.hortonworks.com",
          "kdc_host" : "enctrl.field.hortonworks.com",
          "admin_server_host" : "enctrl.field.hortonworks.com",
          "executable_search_paths" : "/usr/bin, /usr/kerberos/bin, /usr/sbin, /usr/lib/mit/bin, /usr/lib/mit/sbin",
          "password_length": "20",
          "password_min_lowercase_letters": "1",
          "password_min_uppercase_letters": "1",
          "password_min_digits": "1",
          "password_min_punctuation": "1",
          "password_min_whitespace": "0",
          "service_check_principal_name" : "-",
          "case_insensitive_username_rules" : "false"
        }
      }
    }
  }
]
-> 1

 2018-11-06,20:02:12 Creating the KERBEROS_CLIENT host components for each host
{
  "status" : 409,
  "message" : "org.apache.ambari.server.controller.spi.ResourceAlreadyExistsException: Attempted to create a host_component which already exists: [clusterName=enseclab, hostName=enseclab-6-1-3.field.hortonworks.com, componentName=KERBEROS_CLIENT]"
}-> 1
{
  "status" : 409,
  "message" : "org.apache.ambari.server.controller.spi.ResourceAlreadyExistsException: Attempted to create a host_component which already exists: [clusterName=enseclab, hostName=enseclab-6-2-1.field.hortonworks.com, componentName=KERBEROS_CLIENT]"
}-> 1
{
  "status" : 409,
  "message" : "org.apache.ambari.server.controller.spi.ResourceAlreadyExistsException: Attempted to create a host_component which already exists: [clusterName=enseclab, hostName=enseclab-6-3-0.field.hortonworks.com, componentName=KERBEROS_CLIENT]"
}-> 1
{
  "status" : 409,
  "message" : "org.apache.ambari.server.controller.spi.ResourceAlreadyExistsException: Attempted to create a host_component which already exists: [clusterName=enseclab, hostName=enseclab-6-4-2.field.hortonworks.com, componentName=KERBEROS_CLIENT]"
}-> 1

2018-11-06,20:02:13 Installing the KERBEROS service and components
{
  "href" : "https://172.26.223.100:8444/api/v1/clusters/enseclab/requests/108",
  "Requests" : {
    "id" : 108,
    "status" : "Accepted"
  }
}
2018-11-06,20:02:17 Sleeping for 1 minute
-> 60

2018-11-06,20:02:17 Stopping all the services
{
  "href" : "https://172.26.223.100:8444/api/v1/clusters/enseclab/requests/109",
  "Requests" : {
    "id" : 109,
    "status" : "Accepted"
  }
}
2018-11-06,20:02:23 Sleeping for 3 minutes
-> 180

2018-11-06,20:02:23 Ambari post 2.7 version does not allow saving credentials

2018-11-06,20:02:23 Enabling Kerberos
{
  "session_attributes" : {
    "kerberos_admin" : {
      "principal" : "admin/admin",
      "password" : "hadoop"
    }
  },
  "Clusters": {
    "security_type" : "KERBEROS"
  }
}

2018-11-06,20:02:23 Starting all services after 2 minutes..Please be patient :)
-> 120
{
  "href" : "https://172.26.223.100:8444/api/v1/clusters/enseclab/requests/110",
  "Requests" : {
    "id" : 110,
    "status" : "Accepted"
  }
}
2018-11-06,20:02:40 Please check Ambari UI
Thank You! :)

2018-11-06,20:04:20 Adding KERBEROS Service to cluster
{
  "status" : 409,
  "message" : "Attempted to create a service which already exists: , clusterName=enseclab serviceName=KERBEROS"
}
2018-11-06,20:04:20 Adding KERBEROS_CLIENT component to the KERBEROS service
-> 1
{
  "status" : 409,
  "message" : "Attempted to create one or more components which already exist:[clusterName=enseclab, serviceName=KERBEROS, componentName=enseclab, desiredState=null, recoveryEnabled=null, componentCategory=null]"
}[
  {
    "Clusters": {
      "desired_config": {
        "type": "krb5-conf",
        "tag": "version1",
        "properties": {
          "domains":"",
          "manage_krb5_conf": "true",
          "conf_dir":"/etc",
	  "content" : "includedir /var/lib/sss/pubconf/krb5.include.d/

[libdefaults]
  renew_lifetime = 7d
  forwardable = true
  default_realm = {{realm}}
  ticket_lifetime = 24h
  dns_lookup_realm = false
  dns_lookup_kdc = false
  rdns = false
  dns_canonicalize_hostname = false
  default_ccache_name = /tmp/krb5cc_%{uid}
  #default_tgs_enctypes = {{encryption_types}}
  #default_tkt_enctypes = {{encryption_types}}

{% if domains %}
[domain_realm]
{%- for domain in domains.split(',') %}
  {{domain|trim()}} = {{realm}}
{%- endfor %}
{% endif %}

[logging]
  default = FILE:/var/log/krb5kdc.log
  admin_server = FILE:/var/log/kadmind.log
  kdc = FILE:/var/log/krb5kdc.log

[realms]
  {{realm}} = {
{%- if master_kdc %}
    master_kdc = {{master_kdc|trim()}}
{%- endif -%}
{%- if kdc_hosts > 0 -%}
{%- set kdc_host_list = kdc_hosts.split(',')  -%}
{%- if kdc_host_list and kdc_host_list|length > 0 %}
    admin_server = {{admin_server_host|default(kdc_host_list[0]|trim(), True)}}
{%- if kdc_host_list -%}
{%- if master_kdc and (master_kdc not in kdc_host_list) %}
    kdc = {{master_kdc|trim()}}
{%- endif -%}
{% for kdc_host in kdc_host_list %}
    kdc = {{kdc_host|trim()}}
{%- endfor -%}
{% endif %}
{%- endif %}
{%- endif %}
  kpasswd_server =  {{master_kdc|trim()}}:464
  default_domain = {{domains.split(',')[0]|trim()}}
  pkinit_anchors = FILE:/var/lib/ipa-client/pki/kdc-ca-bundle.pem
  pkinit_pool = FILE:/var/lib/ipa-client/pki/ca-bundle.pem
  }

{# Append additional realm declarations below #}"
        }
      }
    }
  },
  {
    "Clusters": {
      "desired_config": {
        "type": "kerberos-env",
        "tag": "version1",
        "properties": {
          "kdc_type": "ipa",
          "manage_identities": "true",
          "install_packages": "true",
          "encryption_types": "aes des3-cbc-sha1 rc4 des-cbc-md5",
          "realm" : "FIELD.HORTONWORKS.COM",
          "kdc_hosts" : "enctrl.field.hortonworks.com",
          "kdc_host" : "enctrl.field.hortonworks.com",
          "admin_server_host" : "enctrl.field.hortonworks.com",
          "executable_search_paths" : "/usr/bin, /usr/kerberos/bin, /usr/sbin, /usr/lib/mit/bin, /usr/lib/mit/sbin",
          "password_length": "20",
          "password_min_lowercase_letters": "1",
          "password_min_uppercase_letters": "1",
          "password_min_digits": "1",
          "password_min_punctuation": "1",
          "password_min_whitespace": "0",
          "service_check_principal_name" : "-",
          "case_insensitive_username_rules" : "false"
        }
      }
    }
  }
]
-> 1

 2018-11-06,20:04:20 Creating the KERBEROS_CLIENT host components for each host
{
  "status" : 409,
  "message" : "org.apache.ambari.server.controller.spi.ResourceAlreadyExistsException: Attempted to create a host_component which already exists: [clusterName=enseclab, hostName=enseclab-6-1-3.field.hortonworks.com, componentName=KERBEROS_CLIENT]"
}-> 1
{
  "status" : 409,
  "message" : "org.apache.ambari.server.controller.spi.ResourceAlreadyExistsException: Attempted to create a host_component which already exists: [clusterName=enseclab, hostName=enseclab-6-2-1.field.hortonworks.com, componentName=KERBEROS_CLIENT]"
}-> 1
{
  "status" : 409,
  "message" : "org.apache.ambari.server.controller.spi.ResourceAlreadyExistsException: Attempted to create a host_component which already exists: [clusterName=enseclab, hostName=enseclab-6-3-0.field.hortonworks.com, componentName=KERBEROS_CLIENT]"
}-> 1
{
  "status" : 409,
  "message" : "org.apache.ambari.server.controller.spi.ResourceAlreadyExistsException: Attempted to create a host_component which already exists: [clusterName=enseclab, hostName=enseclab-6-4-2.field.hortonworks.com, componentName=KERBEROS_CLIENT]"
}-> 1

2018-11-06,20:04:20 Installing the KERBEROS service and components
{
  "href" : "https://172.26.223.100:8444/api/v1/clusters/enseclab/requests/111",
  "Requests" : {
    "id" : 111,
    "status" : "Accepted"
  }
}
2018-11-06,20:04:25 Sleeping for 1 minute
-> 60

2018-11-06,20:04:25 Stopping all the services
{
  "href" : "https://172.26.223.100:8444/api/v1/clusters/enseclab/requests/112",
  "Requests" : {
    "id" : 112,
    "status" : "Accepted"
  }
}
2018-11-06,20:04:30 Sleeping for 3 minutes
-> 180

2018-11-06,20:04:30 Ambari post 2.7 version does not allow saving credentials

2018-11-06,20:04:30 Enabling Kerberos
{
  "session_attributes" : {
    "kerberos_admin" : {
      "principal" : "admin/admin",
      "password" : "hadoop"
    }
  },
  "Clusters": {
    "security_type" : "KERBEROS"
  }
}

2018-11-06,20:04:30 Starting all services after 2 minutes..Please be patient :)
-> 120
{
  "href" : "https://172.26.223.100:8444/api/v1/clusters/enseclab/requests/113",
  "Requests" : {
    "id" : 113,
    "status" : "Accepted"
  }
}
2018-11-06,20:04:49 Please check Ambari UI
Thank You! :)

2018-11-06,20:11:38 Adding KERBEROS Service to cluster
{
  "status" : 409,
  "message" : "Attempted to create a service which already exists: , clusterName=enseclab serviceName=KERBEROS"
}
2018-11-06,20:11:38 Adding KERBEROS_CLIENT component to the KERBEROS service
-> 1
{
  "status" : 409,
  "message" : "Attempted to create one or more components which already exist:[clusterName=enseclab, serviceName=KERBEROS, componentName=enseclab, desiredState=null, recoveryEnabled=null, componentCategory=null]"
}[
  {
    "Clusters": {
      "desired_config": {
        "type": "krb5-conf",
        "tag": "version1",
        "properties": {
          "domains":"",
          "manage_krb5_conf": "true",
          "conf_dir":"/etc",
	  "content" : "includedir /var/lib/sss/pubconf/krb5.include.d/

[libdefaults]
  renew_lifetime = 7d
  forwardable = true
  default_realm = {{realm}}
  ticket_lifetime = 24h
  dns_lookup_realm = false
  dns_lookup_kdc = false
  rdns = false
  dns_canonicalize_hostname = false
  default_ccache_name = /tmp/krb5cc_%{uid}
  #default_tgs_enctypes = {{encryption_types}}
  #default_tkt_enctypes = {{encryption_types}}

{% if domains %}
[domain_realm]
{%- for domain in domains.split(',') %}
  {{domain|trim()}} = {{realm}}
{%- endfor %}
{% endif %}

[logging]
  default = FILE:/var/log/krb5kdc.log
  admin_server = FILE:/var/log/kadmind.log
  kdc = FILE:/var/log/krb5kdc.log

[realms]
  {{realm}} = {
{%- if master_kdc %}
    master_kdc = {{master_kdc|trim()}}
{%- endif -%}
{%- if kdc_hosts > 0 -%}
{%- set kdc_host_list = kdc_hosts.split(',')  -%}
{%- if kdc_host_list and kdc_host_list|length > 0 %}
    admin_server = {{admin_server_host|default(kdc_host_list[0]|trim(), True)}}
{%- if kdc_host_list -%}
{%- if master_kdc and (master_kdc not in kdc_host_list) %}
    kdc = {{master_kdc|trim()}}
{%- endif -%}
{% for kdc_host in kdc_host_list %}
    kdc = {{kdc_host|trim()}}
{%- endfor -%}
{% endif %}
{%- endif %}
{%- endif %}
  kpasswd_server =  {{master_kdc|trim()}}:464
  default_domain = {{domains.split(',')[0]|trim()}}
  pkinit_anchors = FILE:/var/lib/ipa-client/pki/kdc-ca-bundle.pem
  pkinit_pool = FILE:/var/lib/ipa-client/pki/ca-bundle.pem
  }

{# Append additional realm declarations below #}"
        }
      }
    }
  },
  {
    "Clusters": {
      "desired_config": {
        "type": "kerberos-env",
        "tag": "version1",
        "properties": {
          "kdc_type": "ipa",
          "manage_identities": "true",
          "install_packages": "true",
          "encryption_types": "aes des3-cbc-sha1 rc4 des-cbc-md5",
          "realm" : "FIELD.HORTONWORKS.COM",
          "kdc_hosts" : "enctrl.field.hortonworks.com",
          "kdc_host" : "enctrl.field.hortonworks.com",
          "admin_server_host" : "enctrl.field.hortonworks.com",
          "executable_search_paths" : "/usr/bin, /usr/kerberos/bin, /usr/sbin, /usr/lib/mit/bin, /usr/lib/mit/sbin",
          "password_length": "20",
          "password_min_lowercase_letters": "1",
          "password_min_uppercase_letters": "1",
          "password_min_digits": "1",
          "password_min_punctuation": "1",
          "password_min_whitespace": "0",
          "service_check_principal_name" : "-",
          "case_insensitive_username_rules" : "false"
        }
      }
    }
  }
]
-> 1

 2018-11-06,20:11:38 Creating the KERBEROS_CLIENT host components for each host
{
  "status" : 409,
  "message" : "org.apache.ambari.server.controller.spi.ResourceAlreadyExistsException: Attempted to create a host_component which already exists: [clusterName=enseclab, hostName=enseclab-6-1-3.field.hortonworks.com, componentName=KERBEROS_CLIENT]"
}-> 1
{
  "status" : 409,
  "message" : "org.apache.ambari.server.controller.spi.ResourceAlreadyExistsException: Attempted to create a host_component which already exists: [clusterName=enseclab, hostName=enseclab-6-2-1.field.hortonworks.com, componentName=KERBEROS_CLIENT]"
}-> 1
{
  "status" : 409,
  "message" : "org.apache.ambari.server.controller.spi.ResourceAlreadyExistsException: Attempted to create a host_component which already exists: [clusterName=enseclab, hostName=enseclab-6-3-0.field.hortonworks.com, componentName=KERBEROS_CLIENT]"
}-> 1
{
  "status" : 409,
  "message" : "org.apache.ambari.server.controller.spi.ResourceAlreadyExistsException: Attempted to create a host_component which already exists: [clusterName=enseclab, hostName=enseclab-6-4-2.field.hortonworks.com, componentName=KERBEROS_CLIENT]"
}-> 1

2018-11-06,20:11:39 Installing the KERBEROS service and components
{
  "href" : "https://172.26.223.100:8444/api/v1/clusters/enseclab/requests/114",
  "Requests" : {
    "id" : 114,
    "status" : "Accepted"
  }
}
2018-11-06,20:11:43 Sleeping for 1 minute
-> 60

2018-11-06,20:11:43 Stopping all the services
{
  "href" : "https://172.26.223.100:8444/api/v1/clusters/enseclab/requests/115",
  "Requests" : {
    "id" : 115,
    "status" : "Accepted"
  }
}
2018-11-06,20:11:49 Sleeping for 3 minutes
-> 180

2018-11-06,20:11:49 Ambari post 2.7 version does not allow saving credentials

2018-11-06,20:11:49 Enabling Kerberos
{
  "session_attributes" : {
    "kerberos_admin" : {
      "principal" : "admin",
      "password" : "admin1234"
    }
  },
  "Clusters": {
    "security_type" : "KERBEROS"
  }
}

2018-11-06,20:11:49 Starting all services after 2 minutes..Please be patient :)
-> 120
{
  "href" : "https://172.26.223.100:8444/api/v1/clusters/enseclab/requests/116",
  "Requests" : {
    "id" : 116,
    "status" : "Accepted"
  }
}
2018-11-06,20:12:09 Please check Ambari UI
Thank You! :)
