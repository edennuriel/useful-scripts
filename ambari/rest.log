curl   -k -H  "X-Requested-By:ambari" "${CURLOPTS}" -u $AMBARI_ADMIN_USER:$AMBARI_ADMIN_PASSWORD  -X PUT https://172.26.223.100:8444/api/v1/clusters/enseclab/services  -d '{"ServiceInfo": {"state" : "STARTED"}}'
curl   -k -H  "X-Requested-By:ambari" "${CURLOPTS}" -u $AMBARI_ADMIN_USER:$AMBARI_ADMIN_PASSWORD  -X GET https://172.26.223.100:8444/api/v1/hosts 
curl   -k -H  "X-Requested-By:ambari" "${CURLOPTS}" -u $AMBARI_ADMIN_USER:$AMBARI_ADMIN_PASSWORD  -X POST https://172.26.223.100:8444/api/v1/clusters/enseclab/services/KERBEROS 
curl   -k -H  "X-Requested-By:ambari" "${CURLOPTS}" -u $AMBARI_ADMIN_USER:$AMBARI_ADMIN_PASSWORD  -X POST https://172.26.223.100:8444/api/v1/clusters/enseclab/services/KERBEROS/components/KERBEROS_CLIENT 
curl   -k -H  "X-Requested-By:ambari" "${CURLOPTS}" -u $AMBARI_ADMIN_USER:$AMBARI_ADMIN_PASSWORD  -X PUT https://172.26.223.100:8444/api/v1/clusters/enseclab  -d '@/tmp/useful-scripts/ambari/payload'
curl   -k -H  "X-Requested-By:ambari" "${CURLOPTS}" -u $AMBARI_ADMIN_USER:$AMBARI_ADMIN_PASSWORD  -X POST https://172.26.223.100:8444/api/v1/clusters/enseclab/hosts?Hosts/host_name=enseclab-6-1-3.field.hortonworks.com  -d '{"host_components" : [{"HostRoles" : {"component_name":"KERBEROS_CLIENT"}}]}'
curl   -k -H  "X-Requested-By:ambari" "${CURLOPTS}" -u $AMBARI_ADMIN_USER:$AMBARI_ADMIN_PASSWORD  -X POST https://172.26.223.100:8444/api/v1/clusters/enseclab/hosts?Hosts/host_name=enseclab-6-2-1.field.hortonworks.com  -d '{"host_components" : [{"HostRoles" : {"component_name":"KERBEROS_CLIENT"}}]}'
curl   -k -H  "X-Requested-By:ambari" "${CURLOPTS}" -u $AMBARI_ADMIN_USER:$AMBARI_ADMIN_PASSWORD  -X POST https://172.26.223.100:8444/api/v1/clusters/enseclab/hosts?Hosts/host_name=enseclab-6-3-0.field.hortonworks.com  -d '{"host_components" : [{"HostRoles" : {"component_name":"KERBEROS_CLIENT"}}]}'
curl   -k -H  "X-Requested-By:ambari" "${CURLOPTS}" -u $AMBARI_ADMIN_USER:$AMBARI_ADMIN_PASSWORD  -X POST https://172.26.223.100:8444/api/v1/clusters/enseclab/hosts?Hosts/host_name=enseclab-6-4-2.field.hortonworks.com  -d '{"host_components" : [{"HostRoles" : {"component_name":"KERBEROS_CLIENT"}}]}'
curl   -k -H  "X-Requested-By:ambari" "${CURLOPTS}" -u $AMBARI_ADMIN_USER:$AMBARI_ADMIN_PASSWORD  -X PUT https://172.26.223.100:8444/api/v1/clusters/enseclab/services/KERBEROS  -d '{"ServiceInfo": {"state" : "INSTALLED"}}'
curl   -k -H  "X-Requested-By:ambari" "${CURLOPTS}" -u $AMBARI_ADMIN_USER:$AMBARI_ADMIN_PASSWORD  -X PUT https://172.26.223.100:8444/api/v1/clusters/enseclab/services  -d '{"ServiceInfo": {"state" : "INSTALLED"}}'
curl   -k -H  "X-Requested-By:ambari" "${CURLOPTS}" -u $AMBARI_ADMIN_USER:$AMBARI_ADMIN_PASSWORD  -X PUT https://172.26.223.100:8444/api/v1/clusters/enseclab  -d '@/tmp/useful-scripts/ambari/payload'
curl   -k -H  "X-Requested-By:ambari" "${CURLOPTS}" -u $AMBARI_ADMIN_USER:$AMBARI_ADMIN_PASSWORD  -X PUT https://172.26.223.100:8444/api/v1/clusters/enseclab/services  -d '{"ServiceInfo": {"state" : "STARTED"}}'
curl   -k -H  "X-Requested-By:ambari" "${CURLOPTS}" -u $AMBARI_ADMIN_USER:$AMBARI_ADMIN_PASSWORD  -X GET https://172.26.223.100:8444/api/v1/hosts 
curl   -k -H  "X-Requested-By:ambari" "${CURLOPTS}" -u $AMBARI_ADMIN_USER:$AMBARI_ADMIN_PASSWORD  -X POST https://172.26.223.100:8444/api/v1/clusters/enseclab/services/KERBEROS 
curl   -k -H  "X-Requested-By:ambari" "${CURLOPTS}" -u $AMBARI_ADMIN_USER:$AMBARI_ADMIN_PASSWORD  -X POST https://172.26.223.100:8444/api/v1/clusters/enseclab/services/KERBEROS/components/KERBEROS_CLIENT 
[
  {
    "Clusters": {
      "desired_config": {
        "type": "krb5-conf",
        "tag": "version1",
        "properties": {
          "domains":"",
          "manage_krb5_conf": "true",
          "conf_dir":"/etc",
	  "content" : "includedir /var/lib/sss/pubconf/krb5.include.d/

[libdefaults]
  renew_lifetime = 7d
  forwardable = true
  default_realm = {{realm}}
  ticket_lifetime = 24h
  dns_lookup_realm = false
  dns_lookup_kdc = false
  rdns = false
  dns_canonicalize_hostname = false
  default_ccache_name = /tmp/krb5cc_%{uid}
  #default_tgs_enctypes = {{encryption_types}}
  #default_tkt_enctypes = {{encryption_types}}

{% if domains %}
[domain_realm]
{%- for domain in domains.split(',') %}
  {{domain|trim()}} = {{realm}}
{%- endfor %}
{% endif %}

[logging]
  default = FILE:/var/log/krb5kdc.log
  admin_server = FILE:/var/log/kadmind.log
  kdc = FILE:/var/log/krb5kdc.log

[realms]
  {{realm}} = {
{%- if master_kdc %}
    master_kdc = {{master_kdc|trim()}}
{%- endif -%}
{%- if kdc_hosts > 0 -%}
{%- set kdc_host_list = kdc_hosts.split(',')  -%}
{%- if kdc_host_list and kdc_host_list|length > 0 %}
    admin_server = {{admin_server_host|default(kdc_host_list[0]|trim(), True)}}
{%- if kdc_host_list -%}
{%- if master_kdc and (master_kdc not in kdc_host_list) %}
    kdc = {{master_kdc|trim()}}
{%- endif -%}
{% for kdc_host in kdc_host_list %}
    kdc = {{kdc_host|trim()}}
{%- endfor -%}
{% endif %}
{%- endif %}
{%- endif %}
  kpasswd_server =  {{master_kdc|trim()}}:464
  default_domain = {{domains.split(',')[0]|trim()}}
  pkinit_anchors = FILE:/var/lib/ipa-client/pki/kdc-ca-bundle.pem
  pkinit_pool = FILE:/var/lib/ipa-client/pki/ca-bundle.pem
  }

{# Append additional realm declarations below #}"
        }
      }
    }
  },
  {
    "Clusters": {
      "desired_config": {
        "type": "kerberos-env",
        "tag": "version1",
        "properties": {
          "kdc_type": "ipa",
          "manage_identities": "true",
          "install_packages": "true",
          "encryption_types": "aes des3-cbc-sha1 rc4 des-cbc-md5",
          "realm" : "FIELD.HORTONWORKS.COM",
          "kdc_hosts" : "enctrl.field.hortonworks.com",
          "kdc_host" : "enctrl.field.hortonworks.com",
          "admin_server_host" : "enctrl.field.hortonworks.com",
          "executable_search_paths" : "/usr/bin, /usr/kerberos/bin, /usr/sbin, /usr/lib/mit/bin, /usr/lib/mit/sbin",
          "password_length": "20",
          "password_min_lowercase_letters": "1",
          "password_min_uppercase_letters": "1",
          "password_min_digits": "1",
          "password_min_punctuation": "1",
          "password_min_whitespace": "0",
          "service_check_principal_name" : "-",
          "case_insensitive_username_rules" : "false"
        }
      }
    }
  }
]
curl   -k -H  "X-Requested-By:ambari" "${CURLOPTS}" -u $AMBARI_ADMIN_USER:$AMBARI_ADMIN_PASSWORD  -X PUT https://172.26.223.100:8444/api/v1/clusters/enseclab  -d '@/tmp/useful-scripts/ambari/payload'
curl   -k -H  "X-Requested-By:ambari" "${CURLOPTS}" -u $AMBARI_ADMIN_USER:$AMBARI_ADMIN_PASSWORD  -X POST https://172.26.223.100:8444/api/v1/clusters/enseclab/hosts?Hosts/host_name=enseclab-6-1-3.field.hortonworks.com  -d '{"host_components" : [{"HostRoles" : {"component_name":"KERBEROS_CLIENT"}}]}'
curl   -k -H  "X-Requested-By:ambari" "${CURLOPTS}" -u $AMBARI_ADMIN_USER:$AMBARI_ADMIN_PASSWORD  -X POST https://172.26.223.100:8444/api/v1/clusters/enseclab/hosts?Hosts/host_name=enseclab-6-2-1.field.hortonworks.com  -d '{"host_components" : [{"HostRoles" : {"component_name":"KERBEROS_CLIENT"}}]}'
curl   -k -H  "X-Requested-By:ambari" "${CURLOPTS}" -u $AMBARI_ADMIN_USER:$AMBARI_ADMIN_PASSWORD  -X POST https://172.26.223.100:8444/api/v1/clusters/enseclab/hosts?Hosts/host_name=enseclab-6-3-0.field.hortonworks.com  -d '{"host_components" : [{"HostRoles" : {"component_name":"KERBEROS_CLIENT"}}]}'
curl   -k -H  "X-Requested-By:ambari" "${CURLOPTS}" -u $AMBARI_ADMIN_USER:$AMBARI_ADMIN_PASSWORD  -X POST https://172.26.223.100:8444/api/v1/clusters/enseclab/hosts?Hosts/host_name=enseclab-6-4-2.field.hortonworks.com  -d '{"host_components" : [{"HostRoles" : {"component_name":"KERBEROS_CLIENT"}}]}'
curl   -k -H  "X-Requested-By:ambari" "${CURLOPTS}" -u $AMBARI_ADMIN_USER:$AMBARI_ADMIN_PASSWORD  -X PUT https://172.26.223.100:8444/api/v1/clusters/enseclab/services/KERBEROS  -d '{"ServiceInfo": {"state" : "INSTALLED"}}'
curl   -k -H  "X-Requested-By:ambari" "${CURLOPTS}" -u $AMBARI_ADMIN_USER:$AMBARI_ADMIN_PASSWORD  -X PUT https://172.26.223.100:8444/api/v1/clusters/enseclab/services  -d '{"ServiceInfo": {"state" : "INSTALLED"}}'
{
  "session_attributes" : {
    "kerberos_admin" : {
      "principal" : "admin",
      "password" : "admin1234"
    }
  },
  "Clusters": {
    "security_type" : "KERBEROS"
  }
}
curl   -k -H  "X-Requested-By:ambari" "${CURLOPTS}" -u $AMBARI_ADMIN_USER:$AMBARI_ADMIN_PASSWORD  -X PUT https://172.26.223.100:8444/api/v1/clusters/enseclab  -d '@/tmp/useful-scripts/ambari/payload'
curl   -k -H  "X-Requested-By:ambari" "${CURLOPTS}" -u $AMBARI_ADMIN_USER:$AMBARI_ADMIN_PASSWORD  -X PUT https://172.26.223.100:8444/api/v1/clusters/enseclab/services  -d '{"ServiceInfo": {"state" : "STARTED"}}'
